$(function(){
	
	
//	var list = 
//	{
//	"pro": "zero",
//	"code": "0",
//	"name": "目录总纲",
//	"mtradm": "m5396742115",
//	"index": 1,
//	"mulu": [
//			{
//			"pro": "one",
//			"code": "0",
//          "name": "公司概况",
//          "mtradm": "m6146942036",
//			"index": 1,
//			"mulu": [
//					{
//						"pro": "two",
//						"code": "0",
//	            		"name": "公司简介",
//	            		"mtradm": "m4435355568",
//						"index": 1,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "简介",
//		            				"mtradm": "m7688408067",
//									"index": 1,
//									"mulu": []
//								}, {
//									"pro": "three",
//									"code": "0",
//		            				"name": "工商信息",
//		            				"mtradm": "m2642747600",
//									"index": 2,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "挂牌信息",
//	            		"mtradm": "m7040460191",
//						"index": 2,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "挂牌信息",
//		            				"mtradm": "m2653733876",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "股权结构",
//	            		"mtradm": "m7207450088",
//						"index": 3,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "十大股东情况",
//		            				"mtradm": "m9024364451",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "股本及变动情况",
//	            		"mtradm": "m5788231004",
//						"index": 4,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "股本及变动情况",
//		            				"mtradm": "m7968168882",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "K线图",
//	            		"mtradm": "m545498363",
//						"index": 5,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "K线图",
//		            				"mtradm": "m5100815816",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "交易情况",
//	            		"mtradm": "m8513322637",
//						"index": 6,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "交易情况",
//		            				"mtradm": "m5630845076",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "人员情况",
//	            		"mtradm": "m9964938995",
//						"index": 7,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "董监高情况",
//		            				"mtradm": "m7061986575",
//									"index": 1,
//									"mulu": []
//								},
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "员工情况",
//		            				"mtradm": "m3523550800",
//									"index": 2,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "重大事件",
//	            		"mtradm": "m2135624194",
//						"index": 8,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "重大事件",
//		            				"mtradm": "m8160920226",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "风险信息",
//	            		"mtradm": "m846714371",
//						"index": 9,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "风险信息",
//		            				"mtradm": "m4167270559",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}, {
//						"pro": "two",
//						"code": "0",
//	            		"name": "投融资情况",
//	            		"mtradm": "m3189944023",
//						"index": 10,
//						"mulu": [
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "融资情况",
//		            				"mtradm": "m9199377344",
//									"index": 1,
//									"mulu": []
//								},
//								{
//									"pro": "three",
//									"code": "0",
//		            				"name": "对外投资",
//		            				"mtradm": "m1974624892",
//									"index": 1,
//									"mulu": []
//								}
//						]
//					}
//			]
//		}, {
//			"pro": "one",
//			"code": "0",
//			"name": "一级目录2",
//			"mtradm": "m5396742115",
//			"index": 2,
//			"mulu": []
//		}
//	]  
//}
	 
//	var _C = CatalogManage(list);
	//_C.AddCatalog("m5396742115")
	//_C.EditCatalog("m5396742115","test11111");
	//_C.DelCatalog("m7688408067");
//	_C.MoveCatalog("m2642747600","down")
})

var CatalogManage = function(list){
	
	
	//添加目录  parentMtradm=父级mtradm
	this.AddCatalog= function(parentMtradm){
		var newCataLog=
					{
			            "pro": "",
						"code": "0",
		            	"name": "新目录",
		            	"mtradm": suiji(),
						"index": 0, 
						"mulu": []
					};
		//找到要执行添加的父亲级对象回调执行添加
		FindObjBymtradm(parentMtradm,list,callBack);
		
		//回调函数完成将新目录添加到父级目录下
		function callBack(obj){
			if(obj.pro == "zero")
			{
				newCataLog.pro = "one";
				newCataLog.name = "新建一级目录"
				
			}else if(obj.pro == "one"){
				
				newCataLog.pro = "two";
				newCataLog.name = "新建二级目录"
				
			}else if(obj.pro == "two"){
				
				newCataLog.pro = "three";
				newCataLog.name = "新建三级目录"
				
			}else if(obj.pro == "three"){
			}
			newCataLog.index = obj.mulu.length+1;
			obj.mulu.push(newCataLog)
		}
		
		//parentObj.mulu.sort(SortBy('index',false,parseInt))
	}
	//删除目录mtradm=当前目录mtradm
	this.DelCatalog = function(mtradm){
		FindObjBymtradm(mtradm,list,callBack);
		
		//回调函数完成目录修改
		function callBack(obj,parentObj){
			var index = $(parentObj.mulu).index($(obj));
			parentObj.mulu.splice(index,1);
			for(var i = 0;i<parentObj.mulu.length;i++)
			{
				parentObj.mulu[i].index= i+1;
			}
		}
	}
	
	//编辑目录名称mtradm=当前目录mtradm，catalogName=新名称
	this.EditCatalog = function(mtradm,catalogName){
		
		FindObjBymtradm(mtradm,list,callBack);
		
		//回调函数完成目录修改
		function callBack(obj){
			obj.name = catalogName; 	
		}
	}
	//编辑目录名称mtradm=当前目录mtradm，position=(up:向上，down向下)
	this.MoveCatalog = function(mtradm,position){
		if(position!="up"&&position!="down")
		{
			alert("移动目录传入参数错误请传入up/down");
			return;
		}
		
		FindObjBymtradm(mtradm,list,callBack);
		
		//回调函数完成目录移动
		function callBack(obj,parentObj){
			var index = $(parentObj.mulu).index($(obj));
			if(index == 0&&position=="up")
			{
				alert("该目录已位于父级目录最顶端不能向上移动");
				return;
			}
			if(index == parentObj.mulu.length-1&&position=="down")
			{
				alert("该目录已位于父级目录最底端不能向下移动");
				return;
			}
			if(position=="up"){
				parentObj.mulu[index-1].index = obj.index;
				obj.index = obj.index-1;
			}else if(position=="down"){
				parentObj.mulu[index+1].index = obj.index;
				obj.index = obj.index+1;
			}
			parentObj.mulu.sort(SortBy("index",false,parseInt))
		}
	}
	
	//编辑目录名称mtradm=当前目录mtradm，codeValue=(0:显示，1：隐藏)
	this.SetCode = function(mtradm,codeValue){
		FindObjBymtradm(mtradm,list,callBack);
		
		//回调函数完成修改COde
		function callBack(obj){
			obj.code = codeValue; 	
		}
	}
	
	
	//根据目录唯一标识找到指定的对象
	function FindObjBymtradm(mtradm,obj,callBack,parentObj){
		var parentObj = null;
		var curObj = null;
		
		GetObj(mtradm,obj,callBack,parentObj);
		function GetObj(mtradm,obj,callBack)
		{
			if(obj.mtradm == mtradm)
			{
				curObj = obj;
				parentObj = obj;
				return curObj;
			}
			for(var i=0; i<obj.mulu.length;i++)
			{
				
				if(obj.mulu[i].mtradm == mtradm)
				{
					curObj = obj.mulu[i];
					parentObj = obj;
				    break;
					return obj.mulu[i];
				}else if(obj.mulu.length>0){
					GetObj(mtradm,obj.mulu[i],callBack)
				}	
			}
		}
		if(callBack&&curObj)
		{
			callBack(curObj,parentObj)
		}
	}
	//排序数组
	function SortBy(filed, rev, primer) {
	    rev = (rev) ? -1 : 1;
	    return function (a, b) {
	        a = a[filed];
	        b = b[filed];
	        if (typeof (primer) != 'undefined') {
	            a = primer(a);
	            b = primer(b);
	        }
	        if (a < b) { return rev * -1; }
	        if (a > b) { return rev * 1; }
	        return 1;
	    }
	}
	function suiji(){
		var mtradm = 'm' + parseInt(Math.random()*10000000000);
		return mtradm;
	}
	
	return{
		AddCatalog:AddCatalog,
		DelCatalog:DelCatalog,
		EditCatalog:EditCatalog,
		MoveCatalog:MoveCatalog,
		SetCode:SetCode
	}

	
}
